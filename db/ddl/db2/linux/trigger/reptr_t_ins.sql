DROP TRIGGER CWSINT.trg_reptr_t_ins;

CREATE TRIGGER CWSINT.trg_reptr_t_ins
AFTER INSERT ON CWSINT.REPTR_T
REFERENCING NEW AS NROW
FOR EACH ROW MODE DB2SQL
BEGIN ATOMIC
	MERGE INTO CWSRS1.REPTR_T tgt USING ( 
		SELECT
			nrow.RPTR_BDGNO,
			nrow.RPTR_CTYNM,
			nrow.COL_RELC,
			nrow.CMM_MTHC,
			nrow.CNFWVR_IND,
			nrow.FDBACK_DOC,
			nrow.RPTR_EMPNM,
			nrow.FEEDBCK_DT,
			nrow.FB_RQR_IND,
			nrow.RPTR_FSTNM,
			nrow.RPTR_LSTNM,
			nrow.MNRPTR_IND,
			nrow.MSG_EXT_NO,
			nrow.MSG_TEL_NO,
			nrow.MID_INI_NM,
			nrow.NMPRFX_DSC,
			nrow.PRM_TEL_NO,
			nrow.PRM_EXT_NO,
			nrow.STATE_C,
			nrow.RPTR_ST_NM,
			nrow.RPTR_ST_NO,
			nrow.SUFX_TLDSC,
			nrow.RPTR_ZIPNO,
			nrow.LST_UPD_ID,
			nrow.LST_UPD_TS,
			nrow.FKREFERL_T,
			nrow.FKLAW_ENFT,
			nrow.ZIP_SFX_NO,
			nrow.CNTY_SPFCD
		FROM sysibm.sysdummy1
	) X ON (tgt.FKREFERL_T = X.FKREFERL_T)
	WHEN MATCHED THEN UPDATE SET 
		RPTR_BDGNO = x.RPTR_BDGNO,
		RPTR_CTYNM = x.RPTR_CTYNM,
		COL_RELC = x.COL_RELC,
		CMM_MTHC = x.CMM_MTHC,
		CNFWVR_IND = x.CNFWVR_IND,
		FDBACK_DOC = x.FDBACK_DOC,
		RPTR_EMPNM = x.RPTR_EMPNM,
		FEEDBCK_DT = x.FEEDBCK_DT,
		FB_RQR_IND = x.FB_RQR_IND,
		RPTR_FSTNM = x.RPTR_FSTNM,
		RPTR_LSTNM = x.RPTR_LSTNM,
		MNRPTR_IND = x.MNRPTR_IND,
		MSG_EXT_NO = x.MSG_EXT_NO,
		MSG_TEL_NO = x.MSG_TEL_NO,
		MID_INI_NM = x.MID_INI_NM,
		NMPRFX_DSC = x.NMPRFX_DSC,
		PRM_TEL_NO = x.PRM_TEL_NO,
		PRM_EXT_NO = x.PRM_EXT_NO,
		STATE_C = x.STATE_C,
		RPTR_ST_NM = x.RPTR_ST_NM,
		RPTR_ST_NO = x.RPTR_ST_NO,
		SUFX_TLDSC = x.SUFX_TLDSC,
		RPTR_ZIPNO = x.RPTR_ZIPNO,
		LST_UPD_ID = x.LST_UPD_ID,
		LST_UPD_TS = x.LST_UPD_TS,
		FKLAW_ENFT = x.FKLAW_ENFT,
		ZIP_SFX_NO = x.ZIP_SFX_NO,
		CNTY_SPFCD = x.CNTY_SPFCD,
		IBMSNAP_OPERATION = 'I',
		IBMSNAP_LOGMARKER = current timestamp
	WHEN NOT MATCHED THEN INSERT (
		RPTR_BDGNO,
		RPTR_CTYNM,
		COL_RELC,
		CMM_MTHC,
		CNFWVR_IND,
		FDBACK_DOC,
		RPTR_EMPNM,
		FEEDBCK_DT,
		FB_RQR_IND,
		RPTR_FSTNM,
		RPTR_LSTNM,
		MNRPTR_IND,
		MSG_EXT_NO,
		MSG_TEL_NO,
		MID_INI_NM,
		NMPRFX_DSC,
		PRM_TEL_NO,
		PRM_EXT_NO,
		STATE_C,
		RPTR_ST_NM,
		RPTR_ST_NO,
		SUFX_TLDSC,
		RPTR_ZIPNO,
		LST_UPD_ID,
		LST_UPD_TS,
		FKREFERL_T,
		FKLAW_ENFT,
		ZIP_SFX_NO,
		CNTY_SPFCD,
		IBMSNAP_OPERATION,
		IBMSNAP_LOGMARKER
	) VALUES (
		x.RPTR_BDGNO,
		x.RPTR_CTYNM,
		x.COL_RELC,
		x.CMM_MTHC,
		x.CNFWVR_IND,
		x.FDBACK_DOC,
		x.RPTR_EMPNM,
		x.FEEDBCK_DT,
		x.FB_RQR_IND,
		x.RPTR_FSTNM,
		x.RPTR_LSTNM,
		x.MNRPTR_IND,
		x.MSG_EXT_NO,
		x.MSG_TEL_NO,
		x.MID_INI_NM,
		x.NMPRFX_DSC,
		x.PRM_TEL_NO,
		x.PRM_EXT_NO,
		x.STATE_C,
		x.RPTR_ST_NM,
		x.RPTR_ST_NO,
		x.SUFX_TLDSC,
		x.RPTR_ZIPNO,
		x.LST_UPD_ID,
		x.LST_UPD_TS,
		x.FKREFERL_T,
		x.FKLAW_ENFT,
		x.ZIP_SFX_NO,
		x.CNTY_SPFCD,
		'I',
		current timestamp
	);
END
