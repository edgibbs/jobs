DROP TRIGGER CWSINT.trg_referl_t_del;

CREATE TRIGGER CWSINT.trg_referl_t_del
AFTER DELETE ON CWSINT.REFERL_T
REFERENCING OLD AS OROW
FOR EACH ROW MODE DB2SQL
BEGIN ATOMIC
	MERGE INTO CWSRS1.REFERL_T tgt USING ( 
	SELECT
		orow.IDENTIFIER,
		orow.ADD_INF_CD,
		orow.ANRPTR_IND,
		orow.PETAPL_IND,
		orow.APRVL_NO,
		orow.APV_STC,
		orow.CR_PERP_CD,
		orow.REFCLSR_DT,
		orow.CMM_MTHC,
		orow.CHILOC_TXT,
		orow.ALGDSC_DOC,
		orow.ER_REF_DOC,
		orow.INVSTG_DOC,
		orow.XRPT_LWIND,
		orow.FMY_AW_IND,
		orow.GVR_ENTC,
		orow.LGL_DEF_CD,
		orow.LGLRGT_IND,
		orow.LMT_ACSSCD,
		orow.XRPT_RCVDT,
		orow.REFERRL_NM,
		orow.ADQT_CS_CD,
		orow.REF_RCV_DT,
		orow.REF_RCV_TM,
		orow.RFR_RSPC,
		orow.RFRD_RSC,
		orow.RSP_DTR_DT,
		orow.RSP_DTR_TM,
		orow.RSP_RTNTXT,
		orow.SCN_NT_TXT,
		orow.SP_INCL_CD,
		orow.SFC_INF_CD,
		orow.UNFD_SR_CD,
		orow.LST_UPD_ID,
		orow.LST_UPD_TS,
		orow.FKREFERL_T,
		orow.FKADDRS_T,
		orow.FKSTFPERS0,
		orow.FKSTFPERST,
		orow.CNTY_SPFCD,
		orow.SPRJRF_IND,
		orow.ZIPPY_IND,
		orow.HOMLES_IND,
		orow.FAMREF_IND,
		orow.FIRST_EODT,
		orow.RSP_AGY_CD,
		orow.L_GVR_ENTC,
		orow.LMT_ACS_DT,
		orow.LMT_ACSDSC,
		orow.ORIGCLS_DT
		FROM sysibm.sysdummy1
	) X ON (tgt.IDENTIFIER = X.IDENTIFIER)
	WHEN MATCHED THEN UPDATE SET 
		ADD_INF_CD = x.ADD_INF_CD,
		ANRPTR_IND = x.ANRPTR_IND,
		PETAPL_IND = x.PETAPL_IND,
		APRVL_NO = x.APRVL_NO,
		APV_STC = x.APV_STC,
		CR_PERP_CD = x.CR_PERP_CD,
		REFCLSR_DT = x.REFCLSR_DT,
		CMM_MTHC = x.CMM_MTHC,
		CHILOC_TXT = x.CHILOC_TXT,
		ALGDSC_DOC = x.ALGDSC_DOC,
		ER_REF_DOC = x.ER_REF_DOC,
		INVSTG_DOC = x.INVSTG_DOC,
		XRPT_LWIND = x.XRPT_LWIND,
		FMY_AW_IND = x.FMY_AW_IND,
		GVR_ENTC = x.GVR_ENTC,
		LGL_DEF_CD = x.LGL_DEF_CD,
		LGLRGT_IND = x.LGLRGT_IND,
		LMT_ACSSCD = x.LMT_ACSSCD,
		XRPT_RCVDT = x.XRPT_RCVDT,
		REFERRL_NM = x.REFERRL_NM,
		ADQT_CS_CD = x.ADQT_CS_CD,
		REF_RCV_DT = x.REF_RCV_DT,
		REF_RCV_TM = x.REF_RCV_TM,
		RFR_RSPC = x.RFR_RSPC,
		RFRD_RSC = x.RFRD_RSC,
		RSP_DTR_DT = x.RSP_DTR_DT,
		RSP_DTR_TM = x.RSP_DTR_TM,
		RSP_RTNTXT = x.RSP_RTNTXT,
		SCN_NT_TXT = x.SCN_NT_TXT,
		SP_INCL_CD = x.SP_INCL_CD,
		SFC_INF_CD = x.SFC_INF_CD,
		UNFD_SR_CD = x.UNFD_SR_CD,
		LST_UPD_ID = x.LST_UPD_ID,
		LST_UPD_TS = x.LST_UPD_TS,
		FKREFERL_T = x.FKREFERL_T,
		FKADDRS_T = x.FKADDRS_T,
		FKSTFPERS0 = x.FKSTFPERS0,
		FKSTFPERST = x.FKSTFPERST,
		CNTY_SPFCD = x.CNTY_SPFCD,
		SPRJRF_IND = x.SPRJRF_IND,
		ZIPPY_IND = x.ZIPPY_IND,
		HOMLES_IND = x.HOMLES_IND,
		FAMREF_IND = x.FAMREF_IND,
		FIRST_EODT = x.FIRST_EODT,
		RSP_AGY_CD = x.RSP_AGY_CD,
		L_GVR_ENTC = x.L_GVR_ENTC,
		LMT_ACS_DT = x.LMT_ACS_DT,
		LMT_ACSDSC = x.LMT_ACSDSC,
		ORIGCLS_DT = x.ORIGCLS_DT,
		IBMSNAP_OPERATION = 'D',
		IBMSNAP_LOGMARKER = current timestamp
	WHEN NOT MATCHED THEN INSERT (
		IDENTIFIER,
		ADD_INF_CD,
		ANRPTR_IND,
		PETAPL_IND,
		APRVL_NO,
		APV_STC,
		CR_PERP_CD,
		REFCLSR_DT,
		CMM_MTHC,
		CHILOC_TXT,
		ALGDSC_DOC,
		ER_REF_DOC,
		INVSTG_DOC,
		XRPT_LWIND,
		FMY_AW_IND,
		GVR_ENTC,
		LGL_DEF_CD,
		LGLRGT_IND,
		LMT_ACSSCD,
		XRPT_RCVDT,
		REFERRL_NM,
		ADQT_CS_CD,
		REF_RCV_DT,
		REF_RCV_TM,
		RFR_RSPC,
		RFRD_RSC,
		RSP_DTR_DT,
		RSP_DTR_TM,
		RSP_RTNTXT,
		SCN_NT_TXT,
		SP_INCL_CD,
		SFC_INF_CD,
		UNFD_SR_CD,
		LST_UPD_ID,
		LST_UPD_TS,
		FKREFERL_T,
		FKADDRS_T,
		FKSTFPERS0,
		FKSTFPERST,
		CNTY_SPFCD,
		SPRJRF_IND,
		ZIPPY_IND,
		HOMLES_IND,
		FAMREF_IND,
		FIRST_EODT,
		RSP_AGY_CD,
		L_GVR_ENTC,
		LMT_ACS_DT,
		LMT_ACSDSC,
		ORIGCLS_DT,
		IBMSNAP_OPERATION,
		IBMSNAP_LOGMARKER
	) VALUES (
		x.IDENTIFIER,
		x.ADD_INF_CD,
		x.ANRPTR_IND,
		x.PETAPL_IND,
		x.APRVL_NO,
		x.APV_STC,
		x.CR_PERP_CD,
		x.REFCLSR_DT,
		x.CMM_MTHC,
		x.CHILOC_TXT,
		x.ALGDSC_DOC,
		x.ER_REF_DOC,
		x.INVSTG_DOC,
		x.XRPT_LWIND,
		x.FMY_AW_IND,
		x.GVR_ENTC,
		x.LGL_DEF_CD,
		x.LGLRGT_IND,
		x.LMT_ACSSCD,
		x.XRPT_RCVDT,
		x.REFERRL_NM,
		x.ADQT_CS_CD,
		x.REF_RCV_DT,
		x.REF_RCV_TM,
		x.RFR_RSPC,
		x.RFRD_RSC,
		x.RSP_DTR_DT,
		x.RSP_DTR_TM,
		x.RSP_RTNTXT,
		x.SCN_NT_TXT,
		x.SP_INCL_CD,
		x.SFC_INF_CD,
		x.UNFD_SR_CD,
		x.LST_UPD_ID,
		x.LST_UPD_TS,
		x.FKREFERL_T,
		x.FKADDRS_T,
		x.FKSTFPERS0,
		x.FKSTFPERST,
		x.CNTY_SPFCD,
		x.SPRJRF_IND,
		x.ZIPPY_IND,
		x.HOMLES_IND,
		x.FAMREF_IND,
		x.FIRST_EODT,
		x.RSP_AGY_CD,
		x.L_GVR_ENTC,
		x.LMT_ACS_DT,
		x.LMT_ACSDSC,
		x.ORIGCLS_DT,
		'D',
		current timestamp
	);
END
