DROP TRIGGER CWSINT.trg_stfperst_del;

CREATE TRIGGER CWSINT.trg_stfperst_del
AFTER DELETE ON CWSINT.STFPERST
REFERENCING OLD AS OROW
FOR EACH ROW MODE DB2SQL
BEGIN ATOMIC
	MERGE INTO CWSRS1.STFPERST tgt USING ( 
		SELECT
		orow.IDENTIFIER,
		orow.END_DT,
		orow.FIRST_NM,
		orow.JOB_TL_DSC,
		orow.LAST_NM,
		orow.MID_INI_NM,
		orow.NMPRFX_DSC,
		orow.PHONE_NO,
		orow.TEL_EXT_NO,
		orow.START_DT,
		orow.SUFX_TLDSC,
		orow.TLCMTR_IND,
		orow.LST_UPD_ID,
		orow.LST_UPD_TS,
		orow.FKCWS_OFFT,
		orow.AVLOC_DSC,
		orow.SSRS_WKRID,
		orow.CNTY_SPFCD,
		orow.DTYWKR_IND,
		orow.FKCWSADDRT,
		orow.EMAIL_ADDR
		FROM sysibm.sysdummy1
	) X ON (tgt.IDENTIFIER = X.IDENTIFIER)
	WHEN MATCHED THEN UPDATE SET 
		IDENTIFIER = x.IDENTIFIER,
		END_DT = x.END_DT,
		FIRST_NM = x.FIRST_NM,
		JOB_TL_DSC = x.JOB_TL_DSC,
		LAST_NM = x.LAST_NM,
		MID_INI_NM = x.MID_INI_NM,
		NMPRFX_DSC = x.NMPRFX_DSC,
		PHONE_NO = x.PHONE_NO,
		TEL_EXT_NO = x.TEL_EXT_NO,
		START_DT = x.START_DT,
		SUFX_TLDSC = x.SUFX_TLDSC,
		TLCMTR_IND = x.TLCMTR_IND,
		LST_UPD_ID = x.LST_UPD_ID,
		LST_UPD_TS = x.LST_UPD_TS,
		FKCWS_OFFT = x.FKCWS_OFFT,
		AVLOC_DSC = x.AVLOC_DSC,
		SSRS_WKRID = x.SSRS_WKRID,
		CNTY_SPFCD = x.CNTY_SPFCD,
		DTYWKR_IND = x.DTYWKR_IND,
		FKCWSADDRT = x.FKCWSADDRT,
		EMAIL_ADDR = x.EMAIL_ADDR,
		IBMSNAP_OPERATION = 'D',
		IBMSNAP_LOGMARKER = current timestamp
	WHEN NOT MATCHED THEN INSERT (
		IDENTIFIER,
		END_DT,
		FIRST_NM,
		JOB_TL_DSC,
		LAST_NM,
		MID_INI_NM,
		NMPRFX_DSC,
		PHONE_NO,
		TEL_EXT_NO,
		START_DT,
		SUFX_TLDSC,
		TLCMTR_IND,
		LST_UPD_ID,
		LST_UPD_TS,
		FKCWS_OFFT,
		AVLOC_DSC,
		SSRS_WKRID,
		CNTY_SPFCD,
		DTYWKR_IND,
		FKCWSADDRT,
		EMAIL_ADDR,
		IBMSNAP_OPERATION,
		IBMSNAP_LOGMARKER
	) VALUES (
		x.IDENTIFIER,
		x.END_DT,
		x.FIRST_NM,
		x.JOB_TL_DSC,
		x.LAST_NM,
		x.MID_INI_NM,
		x.NMPRFX_DSC,
		x.PHONE_NO,
		x.TEL_EXT_NO,
		x.START_DT,
		x.SUFX_TLDSC,
		x.TLCMTR_IND,
		x.LST_UPD_ID,
		x.LST_UPD_TS,
		x.FKCWS_OFFT,
		x.AVLOC_DSC,
		x.SSRS_WKRID,
		x.CNTY_SPFCD,
		x.DTYWKR_IND,
		x.FKCWSADDRT,
		x.EMAIL_ADDR,
		'D',
		current timestamp
	);
END
