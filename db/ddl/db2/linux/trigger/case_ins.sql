DROP TRIGGER CWSINT.trg_case_ins;

CREATE TRIGGER CWSINT.trg_case_ins
AFTER INSERT ON CWSINT.CASE_T
REFERENCING NEW AS NROW
FOR EACH ROW MODE DB2SQL
BEGIN ATOMIC
	MERGE INTO CWSRS1.CASE_T adr USING (
		SELECT 
			nrow.IDENTIFIER,
			nrow.START_DT,
			nrow.SRV_CMPC,
			nrow.APRVL_NO,
			nrow.APV_STC,
			nrow.CLS_RSNC,
			nrow.CSPL_DET_B,
			nrow.CL_STM_TXT,
			nrow.CNTRY_C,
			nrow.NOTES_DOC,
			nrow.END_DT,
			nrow.GVR_ENTC,
			nrow.ICPCSTAT_B,
			nrow.ICPC_RQT_B,
			nrow.LMT_ACSSCD,
			nrow.CASE_NM,
			nrow.PRJ_END_DT,
			nrow.SPRJ_CST_B,
			nrow.STATE_C,
			nrow.TICKLE_T_B,
			nrow.LST_UPD_ID,
			nrow.LST_UPD_TS,
			nrow.FKCHLD_CLT,
			nrow.SRV_CMPDT,
			nrow.FKSTFPERST,
			nrow.CNTY_SPFCD,
			nrow.ALERT_TXT,
			nrow.FKREFERL_T,
			nrow.RSP_AGY_CD,
			nrow.NXT_TILPDT,
			nrow.EMANCPN_DT,
			nrow.L_GVR_ENTC,
			nrow.LMT_ACS_DT,
			nrow.LMT_ACSDSC
		FROM sysibm.sysdummy1
	) X ON (adr.IDENTIFIER = X.IDENTIFIER) 
	WHEN MATCHED THEN UPDATE SET 
		START_DT = x.START_DT,
		SRV_CMPC = x.SRV_CMPC,
		APRVL_NO = x.APRVL_NO,
		APV_STC = x.APV_STC,
		CLS_RSNC = x.CLS_RSNC,
		CSPL_DET_B = x.CSPL_DET_B,
		CL_STM_TXT = x.CL_STM_TXT,
		CNTRY_C = x.CNTRY_C,
		NOTES_DOC = x.NOTES_DOC,
		END_DT = x.END_DT,
		GVR_ENTC = x.GVR_ENTC,
		ICPCSTAT_B = x.ICPCSTAT_B,
		ICPC_RQT_B = x.ICPC_RQT_B,
		LMT_ACSSCD = x.LMT_ACSSCD,
		CASE_NM = x.CASE_NM,
		PRJ_END_DT = x.PRJ_END_DT,
		SPRJ_CST_B = x.SPRJ_CST_B,
		STATE_C = x.STATE_C,
		TICKLE_T_B = x.TICKLE_T_B,
		LST_UPD_ID = x.LST_UPD_ID,
		LST_UPD_TS = x.LST_UPD_TS,
		FKCHLD_CLT = x.FKCHLD_CLT,
		SRV_CMPDT = x.SRV_CMPDT,
		FKSTFPERST = x.FKSTFPERST,
		CNTY_SPFCD = x.CNTY_SPFCD,
		ALERT_TXT = x.ALERT_TXT,
		FKREFERL_T = x.FKREFERL_T,
		RSP_AGY_CD = x.RSP_AGY_CD,
		NXT_TILPDT = x.NXT_TILPDT,
		EMANCPN_DT = x.EMANCPN_DT,
		L_GVR_ENTC = x.L_GVR_ENTC,
		LMT_ACS_DT = x.LMT_ACS_DT,
		LMT_ACSDSC = x.LMT_ACSDSC,
		IBMSNAP_OPERATION = 'I',
		IBMSNAP_LOGMARKER = current timestamp
	WHEN NOT MATCHED THEN INSERT (
	    IDENTIFIER,
		START_DT,
		SRV_CMPC,
		APRVL_NO,
		APV_STC,
		CLS_RSNC,
		CSPL_DET_B,
		CL_STM_TXT,
		CNTRY_C,
		NOTES_DOC,
		END_DT,
		GVR_ENTC,
		ICPCSTAT_B,
		ICPC_RQT_B,
		LMT_ACSSCD,
		CASE_NM,
		PRJ_END_DT,
		SPRJ_CST_B,
		STATE_C,
		TICKLE_T_B,
		LST_UPD_ID,
		LST_UPD_TS,
		FKCHLD_CLT,
		SRV_CMPDT,
		FKSTFPERST,
		CNTY_SPFCD,
		ALERT_TXT,
		FKREFERL_T,
		RSP_AGY_CD,
		NXT_TILPDT,
		EMANCPN_DT,
		L_GVR_ENTC,
		LMT_ACS_DT,
		LMT_ACSDSC,
		IBMSNAP_OPERATION,
		IBMSNAP_LOGMARKER
	) VALUES (
		x.IDENTIFIER,
		x.START_DT,
		x.SRV_CMPC,
		x.APRVL_NO,
		x.APV_STC,
		x.CLS_RSNC,
		x.CSPL_DET_B,
		x.CL_STM_TXT,
		x.CNTRY_C,
		x.NOTES_DOC,
		x.END_DT,
		x.GVR_ENTC,
		x.ICPCSTAT_B,
		x.ICPC_RQT_B,
		x.LMT_ACSSCD,
		x.CASE_NM,
		x.PRJ_END_DT,
		x.SPRJ_CST_B,
		x.STATE_C,
		x.TICKLE_T_B,
		x.LST_UPD_ID,
		x.LST_UPD_TS,
		x.FKCHLD_CLT,
		x.SRV_CMPDT,
		x.FKSTFPERST,
		x.CNTY_SPFCD,
		x.ALERT_TXT,
		x.FKREFERL_T,
		x.RSP_AGY_CD,
		x.NXT_TILPDT,
		x.EMANCPN_DT,
		x.L_GVR_ENTC,
		x.LMT_ACS_DT,
		x.LMT_ACSDSC,
		'I',
		current timestamp
	);
END
