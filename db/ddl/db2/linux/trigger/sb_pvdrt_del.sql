DROP TRIGGER CWSINT.trg_sb_pvdrt_del;

CREATE TRIGGER CWSINT.trg_sb_pvdrt_del
AFTER DELETE ON CWSINT.SB_PVDRT
REFERENCING OLD AS OROW
FOR EACH ROW MODE DB2SQL
BEGIN ATOMIC
	MERGE INTO CWSRS1.SB_PVDRT tgt USING ( 
		SELECT
		orow.IDENTIFIER,
		orow.ADD_TEL_NO,
		orow.ADD_EXT_NO,
		orow.BIRTH_DT,
		orow.CA_DLIC_NO,
		orow.CITY_NM,
		orow.EMPLYR_NM,
		orow.FIRST_NM,
		orow.FRG_ADRT_B,
		orow.GENDER_IND,
		orow.IND_TRBC,
		orow.LAST_NM,
		orow.MID_INI_NM,
		orow.NMPRFX_DSC,
		orow.SS_NO,
		orow.STATE_C,
		orow.STREET_NM,
		orow.STREET_NO,
		orow.SUFX_TLDSC,
		orow.ZIP_NO,
		orow.LST_UPD_ID,
		orow.LST_UPD_TS,
		orow.ZIP_SFX_NO,
		orow.EDUCATION,
		orow.EMPL_STAT,
		orow.PRIM_INC,
		orow.SEC_INC,
		orow.YR_INC_AMT,
		orow.HISP_CD,
		orow.MRTL_STC,
		orow.LISOWNIND,
		orow.LIS_PER_ID,
		orow.EMAIL_ADDR,
		orow.ETH_UD_CD,
		orow.HISP_UD_CD,
		orow.RESOST_IND,
		orow.PASSBC_CD
		FROM sysibm.sysdummy1
	) X ON (tgt.IDENTIFIER = X.IDENTIFIER)
	WHEN MATCHED THEN UPDATE SET 
		ADD_TEL_NO = x.ADD_TEL_NO,
		ADD_EXT_NO = x.ADD_EXT_NO,
		BIRTH_DT = x.BIRTH_DT,
		CA_DLIC_NO = x.CA_DLIC_NO,
		CITY_NM = x.CITY_NM,
		EMPLYR_NM = x.EMPLYR_NM,
		FIRST_NM = x.FIRST_NM,
		FRG_ADRT_B = x.FRG_ADRT_B,
		GENDER_IND = x.GENDER_IND,
		IND_TRBC = x.IND_TRBC,
		LAST_NM = x.LAST_NM,
		MID_INI_NM = x.MID_INI_NM,
		NMPRFX_DSC = x.NMPRFX_DSC,
		SS_NO = x.SS_NO,
		STATE_C = x.STATE_C,
		STREET_NM = x.STREET_NM,
		STREET_NO = x.STREET_NO,
		SUFX_TLDSC = x.SUFX_TLDSC,
		ZIP_NO = x.ZIP_NO,
		LST_UPD_ID = x.LST_UPD_ID,
		LST_UPD_TS = x.LST_UPD_TS,
		ZIP_SFX_NO = x.ZIP_SFX_NO,
		EDUCATION = x.EDUCATION,
		EMPL_STAT = x.EMPL_STAT,
		PRIM_INC = x.PRIM_INC,
		SEC_INC = x.SEC_INC,
		YR_INC_AMT = x.YR_INC_AMT,
		HISP_CD = x.HISP_CD,
		MRTL_STC = x.MRTL_STC,
		LISOWNIND = x.LISOWNIND,
		LIS_PER_ID = x.LIS_PER_ID,
		EMAIL_ADDR = x.EMAIL_ADDR,
		ETH_UD_CD = x.ETH_UD_CD,
		HISP_UD_CD = x.HISP_UD_CD,
		RESOST_IND = x.RESOST_IND,
		PASSBC_CD = x.PASSBC_CD,
		IBMSNAP_OPERATION = 'D',
		IBMSNAP_LOGMARKER = current timestamp
	WHEN NOT MATCHED THEN INSERT (
		IDENTIFIER,
		ADD_TEL_NO,
		ADD_EXT_NO,
		BIRTH_DT,
		CA_DLIC_NO,
		CITY_NM,
		EMPLYR_NM,
		FIRST_NM,
		FRG_ADRT_B,
		GENDER_IND,
		IND_TRBC,
		LAST_NM,
		MID_INI_NM,
		NMPRFX_DSC,
		SS_NO,
		STATE_C,
		STREET_NM,
		STREET_NO,
		SUFX_TLDSC,
		ZIP_NO,
		LST_UPD_ID,
		LST_UPD_TS,
		ZIP_SFX_NO,
		EDUCATION,
		EMPL_STAT,
		PRIM_INC,
		SEC_INC,
		YR_INC_AMT,
		HISP_CD,
		MRTL_STC,
		LISOWNIND,
		LIS_PER_ID,
		EMAIL_ADDR,
		ETH_UD_CD,
		HISP_UD_CD,
		RESOST_IND,
		PASSBC_CD,
		IBMSNAP_OPERATION,
		IBMSNAP_LOGMARKER
	) VALUES (
		x.IDENTIFIER,
		x.ADD_TEL_NO,
		x.ADD_EXT_NO,
		x.BIRTH_DT,
		x.CA_DLIC_NO,
		x.CITY_NM,
		x.EMPLYR_NM,
		x.FIRST_NM,
		x.FRG_ADRT_B,
		x.GENDER_IND,
		x.IND_TRBC,
		x.LAST_NM,
		x.MID_INI_NM,
		x.NMPRFX_DSC,
		x.SS_NO,
		x.STATE_C,
		x.STREET_NM,
		x.STREET_NO,
		x.SUFX_TLDSC,
		x.ZIP_NO,
		x.LST_UPD_ID,
		x.LST_UPD_TS,
		x.ZIP_SFX_NO,
		x.EDUCATION,
		x.EMPL_STAT,
		x.PRIM_INC,
		x.SEC_INC,
		x.YR_INC_AMT,
		x.HISP_CD,
		x.MRTL_STC,
		x.LISOWNIND,
		x.LIS_PER_ID,
		x.EMAIL_ADDR,
		x.ETH_UD_CD,
		x.HISP_UD_CD,
		x.RESOST_IND,
		x.PASSBC_CD,
		'D',
		current timestamp
	);
END
